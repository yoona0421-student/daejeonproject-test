<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëŒ€ì „ ì»¤ë®¤ë‹ˆí‹°</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="replit-ui.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <style>
    body {
      background: #f7f8fa;
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
    }
    .main-header {
      background: #fff;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      padding: 28px 48px 18px 48px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 24px;
    }
    .header-title-group h1 {
      font-size: 2.1em;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .header-title-group .subtitle {
      font-size: 1.08em;
      color: #888;
      margin-left: 2px;
    }
    .nav-bar {
      background: #fff;
      display: flex;
      align-items: center;
      gap: 32px;
      padding: 0 48px;
      height: 54px;
      border-bottom: 1.5px solid #eee;
      font-size: 1.08em;
      font-weight: 500;
    }
    .nav-bar .nav-item {
      color: #34495e;
      cursor: pointer;
      padding: 0 12px;
      border-radius: 8px;
      transition: background 0.15s;
    }
    .nav-bar .nav-item:hover {
      background: #ffe06633;
    }
    .main-layout {
      display: flex;
      gap: 32px;
      padding: 32px 48px 0 48px;
      min-height: 80vh;
    }
    .sidebar {
      width: 340px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .map-col {
      flex: 4;
      min-width: 240px;
      max-width: 840px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .layer-control-panel {
      flex: 2;
      min-width: 220px;
      max-width: 350px;
      padding: 32px 18px 32px 18px;
      background: #fffbe6;
      border-radius: 24px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.10);
      border: 2px solid #ffe066;
      margin: 18px 0 18px 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: stretch;
    }
  </style>
</head>
<body>
  <!-- ìš°ë¦¬ ì§€ì—­ ìœ„í—˜ ì œë³´í•˜ê¸° ëª¨ë‹¬ -->
  <div id="reportModal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.18); z-index:2000; align-items:center; justify-content:center;">
    <div style="background:#fff; border-radius:18px; box-shadow:0 8px 32px rgba(0,0,0,0.10); padding:38px 32px 32px 32px; min-width:340px; max-width:98vw; position:relative;">
      <button id="closeModal" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.6em; color:#888; cursor:pointer;">&times;</button>
      <h2 style="margin-top:0; margin-bottom:18px; font-size:1.6em; font-weight:700; color:#222; display:flex; align-items:center; gap:8px;">
        <img src="dream_family_01.png" alt="ë²ˆê°œ" style="height:56px; width:auto; vertical-align:middle;"> ìš°ë¦¬ ì§€ì—­ ìœ„í—˜ ì œë³´í•˜ê¸°
      </h2>
      <form id="reportForm">
        <label for="reportType" style="font-weight:600; color:#444;">ì œë³´ ìœ í˜•</label><br>
        <select id="reportType" required style="width:100%; margin-bottom:18px; padding:8px; border-radius:8px; border:1.5px solid #ffe066;">
          <option value="">ì œë³´ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
          <option value="êµí†µ ìœ„í—˜">êµí†µ ìœ„í—˜</option>
          <option value="ì‹œì„¤ ìœ„í—˜">ì‹œì„¤ ìœ„í—˜</option>
          <option value="ê¸°íƒ€">ê¸°íƒ€</option>
        </select>
        <label for="district" style="font-weight:600; color:#444;">ëŒ€ì „ê´‘ì—­ì‹œ êµ¬</label><br>
        <select id="district" required style="width:100%; margin-bottom:18px; padding:8px; border-radius:8px; border:1.5px solid #ffe066;">
          <option value="">êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
          <option value="ë™êµ¬">ë™êµ¬</option>
          <option value="ì¤‘êµ¬">ì¤‘êµ¬</option>
          <option value="ì„œêµ¬">ì„œêµ¬</option>
          <option value="ìœ ì„±êµ¬">ìœ ì„±êµ¬</option>
          <option value="ëŒ€ë•êµ¬">ëŒ€ë•êµ¬</option>
        </select>
        <label for="content" style="font-weight:600; color:#444;">ë‚´ìš©</label><br>
        <textarea id="content" rows="4" required style="width:100%; margin-bottom:18px; padding:8px; border-radius:8px; border:1.5px solid #ffe066;"></textarea>
        <label style="font-weight:600; color:#444;">ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)</label><br>
        <div id="imageDropZone" style="border:2px dashed #ffe066; background:#fffbe6; color:#b2b200; font-size:1em; border-radius:10px; padding:18px; text-align:center; margin-bottom:18px; cursor:pointer;">
          <span id="imageDropText">ì‚¬ì§„ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</span>
          <input type="file" id="imageInput" accept="image/*" style="display:none;">
          <div id="previewImage" style="display:none; margin-top:8px;"></div>
        </div>
        <div style="display:flex; gap:12px; justify-content:flex-end; margin-top:18px;">
          <button type="button" id="cancelBtn" style="background:#eee; color:#444; border:none; border-radius:8px; padding:8px 22px; font-size:1em; cursor:pointer;">ì·¨ì†Œ</button>
          <button type="submit" style="background:#6fcf97; color:#fff; border:none; border-radius:8px; padding:8px 22px; font-size:1em; font-weight:600; cursor:pointer;">ì œë³´í•˜ê¸°</button>
        </div>
      </form>
    </div>
  </div>
  <!-- ì˜¤ë¥¸ìª½ ìƒë‹¨ ê³ ì • ì•ˆì „ì œë³´í•˜ê¸° ë²„íŠ¼ -->
  <button id="floatingReportBtn" style="position:fixed; right:32px; top:80px; z-index:1200; background:#6fcf97; color:#fff; border:2px solid #27ae60; padding:16px 28px; border-radius:50px; font-size:18px; font-family:'Gowun Dodum','Pretendard','Noto Sans KR',sans-serif; box-shadow:0 4px 16px rgba(0,0,0,0.12); cursor:pointer;">ìš°ë¦¬ ì§€ì—­ ìœ„í—˜ ì œë³´í•˜ê¸°</button>
  <nav class="nav-bar">
  <a href="index.html"><img src="daejeon_logo.png" alt="ëŒ€ì „ ë¡œê³ " style="height:200px; margin-right:18px; width:auto;"></a>
      <span class="nav-item">ì •ë³´ê³µê°œ</span>
      <span class="nav-item">ì°¸ì—¬ë§ˆë‹¹</span>
      <span class="nav-item">ì „ìë¯¼ì›</span>
      <span class="nav-item">í–‰ì •ì •ë³´</span>
      <span class="nav-item">ìƒí™œì •ë³´</span>
      <span class="nav-item">ëŒ€ì „ì†Œê°œ</span>
      <span class="nav-item">ë¶„ì•¼ë³„ì •ë³´</span>
      <a class="nav-item" href="community.html" style="background:#fff8dc; padding:6px 18px; border-radius:12px; font-weight:600; color:#222; text-decoration:none;">ì»¤ë®¤ë‹ˆí‹°</a>
  </nav>
  <header class="main-header">
    <div class="header-left">
      <img src="ê¿ˆëŒì´.png" alt="ê¿ˆëŒì´" class="dreamdori-animate" style="height:50px; margin-right:10px; width:auto; aspect-ratio:1/1;">
      <div class="header-title-group">
  <h1>ëŒ€ì•ˆì±…(ëŒ€ì „ ì•ˆì „ <span style="color:#27ae60;font-weight:bold;">CHECK</span>) - ì–´ë¦°ì´ ë³´í˜¸ ì‚¬ê°ì§€ëŒ€ ë°€ë„ê¸°ë°˜ êµ°ì§‘ë¶„ì„ ì›¹ ì„œë¹„ìŠ¤</h1>
        <div class="subtitle">ê¿ˆëŒì´ì™€ í•¨ê»˜í•˜ëŠ” ì•ˆì „í•œ í†µí•™ë¡œ</div>
      </div>
    </div>
    <!-- í—¤ë”ì—ì„œ ì•ˆì „ì œë³´í•˜ê¸° ë²„íŠ¼ ì œê±° -->
  </header>
  <div class="main-layout">
    <aside class="sidebar">
      <!-- ì‚¬ì´ë“œë°” ë‚´ìš© í•„ìš”ì‹œ ì¶”ê°€ -->
    </aside>
    <div class="map-col">
      <section class="community-board" style="width:100%; max-width:900px; margin:0 auto;">
        <h2 style="font-size:1.5em; font-weight:700; color:#27ae60; margin-bottom:18px; display:flex; align-items:center; gap:10px;">
          <img src="ê¿ˆëŒì´.png" alt="ê¿ˆëŒì´" style="height:38px; vertical-align:middle;"> ëŒ€ì „ ì•ˆì „ ì œë³´ ì»¤ë®¤ë‹ˆí‹°
        </h2>
        <div id="community-cards"></div>
      </section>
      <script>
      // ì•ˆì „ì œë³´í•˜ê¸° ë²„íŠ¼ ë° ëª¨ë‹¬ ë™ì‘ êµ¬í˜„
      document.addEventListener('DOMContentLoaded', function() {
        const floatingReportBtn = document.getElementById('floatingReportBtn');
        const reportModal = document.getElementById('reportModal');
        const closeModal = document.getElementById('closeModal');
        const reportForm = document.getElementById('reportForm');
        const cancelBtn = document.getElementById('cancelBtn');
        const imageDropZone = document.getElementById('imageDropZone');
        const imageInput = document.getElementById('imageInput');
        const previewImage = document.getElementById('previewImage');
        const imageDropText = document.getElementById('imageDropText');

        floatingReportBtn.onclick = () => {
          reportModal.style.display = 'flex';
        };
        closeModal.onclick = () => {
          reportModal.style.display = 'none';
        };
        cancelBtn.onclick = () => {
          reportModal.style.display = 'none';
        };

        imageDropZone.onclick = () => imageInput.click();
        imageDropZone.ondragover = (e) => {
          e.preventDefault();
          imageDropZone.style.background = '#e0e7ff';
        };
        imageDropZone.ondragleave = (e) => {
          e.preventDefault();
          imageDropZone.style.background = '#fafafa';
        };
        imageDropZone.ondrop = (e) => {
          e.preventDefault();
          imageDropZone.style.background = '#fafafa';
          if (e.dataTransfer.files && e.dataTransfer.files[0]) {
            imageInput.files = e.dataTransfer.files;
            handleImageUpload(e.dataTransfer.files[0]);
          }
        };
        imageInput.onchange = (e) => {
          if (e.target.files && e.target.files[0]) {
            handleImageUpload(e.target.files[0]);
          }
        };
        function handleImageUpload(file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            previewImage.style.display = 'block';
            previewImage.innerHTML = `<img src="${e.target.result}" style="max-width:100%; max-height:80px; border-radius:8px;">`;
            imageDropText.style.display = 'none';
          };
          reader.readAsDataURL(file);
        }

        reportForm.onsubmit = function(e) {
          e.preventDefault();
          const reportType = document.getElementById('reportType').value;
          const district = document.getElementById('district').value;
          const content = document.getElementById('content').value.trim();
          let imageData = '';
          if (imageInput.files && imageInput.files[0]) {
            const reader = new FileReader();
            reader.onload = function(ev) {
              imageData = ev.target.result;
              saveReport(reportType, district, content, imageData);
            };
            reader.readAsDataURL(imageInput.files[0]);
          } else {
            saveReport(reportType, district, content, '');
          }
        };
        function saveReport(reportType, district, content, imageData) {
          if (!content || !reportType || !district) return;
          var reports = JSON.parse(localStorage.getItem('reports') || '[]');
          var uniqueId = Date.now().toString() + Math.random().toString(36).substr(2, 9);
          reports.push({ id: uniqueId, reportType: reportType, district: district, content: content, imageData: imageData, date: new Date().toLocaleString() });
          localStorage.setItem('reports', JSON.stringify(reports));
          reportModal.style.display = 'none';
          reportForm.reset();
          previewImage.style.display = 'none';
          imageDropText.style.display = 'block';
          imageInput.value = '';
          alert('ì œë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
          // ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ ì¦‰ì‹œ ê°±ì‹ 
          if (typeof renderCommunityCards === 'function') renderCommunityCards();
        }
      });
      // êµ¬ë³„ ìƒ‰ìƒ ë° ì•„ì´ì½˜
      const guStyle = {
  'ë™êµ¬': { color: '#d35400', emoji: '', img: 'donggu.png' },
  'ì¤‘êµ¬': { color: '#8e44ad', emoji: '', img: 'junggu.png' },
  'ì„œêµ¬': { color: '#2980b9', emoji: '', img: 'seogu.png' },
  'ìœ ì„±êµ¬': { color: '#27ae60', emoji: '', img: 'yousunggu.png' },
  'ëŒ€ë•êµ¬': { color: '#7f8c8d', emoji: '', img: 'daeduckgu.png' }
      };

      // ì„œë²„ì—ì„œ ëˆ„ì  ê²Œì‹œë¬¼ ë¶ˆëŸ¬ì™€ì„œ ë Œë”ë§
      async function renderCommunityCards() {
        const container = document.getElementById('community-cards');
        try {
          const res = await fetch('/api/reports');
          const reports = await res.json();
          if (!reports || reports.length === 0) {
            container.innerHTML = `<div style="text-align:center; color:#888; font-size:1.1em; margin:48px 0;">ì•„ì§ ë“±ë¡ëœ ìš°ë¦¬ ì§€ì—­ ìœ„í—˜ ì œë³´ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ìƒë‹¨ 'ìš°ë¦¬ ì§€ì—­ ìœ„í—˜ ì œë³´í•˜ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ì œë³´ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div>`;
            return;
          }
          // êµ¬ë³„ë¡œ ê·¸ë£¹í™”
          const grouped = {};
          reports.forEach(r => {
            if (!grouped[r.district]) grouped[r.district] = [];
            grouped[r.district].push(r);
          });
          let html = '';
          Object.keys(grouped).forEach(gu => {
            const style = guStyle[gu] || { color: '#ffe066', emoji: 'ğŸ™ï¸' };
            html += `<div class="gu-group" style="margin-bottom:32px;">
              <h3 style="color:${style.color}; font-size:1.18em; font-weight:700; margin-bottom:12px; display:flex; align-items:center; gap:8px;">
                ${style.img ? `<img src="${style.img}" alt="${gu}" style="height:32px; vertical-align:middle;">` : `<span style="font-size:1.5em;">${style.emoji}</span>`} ${gu}
              </h3>
              <div class="gu-box" style="background:#fff; border-radius:24px; box-shadow:0 2px 12px rgba(0,0,0,0.06); padding:24px 18px; margin-bottom:8px;">
                <div class="card-list" style="display:flex; flex-wrap:wrap; gap:18px;">
                  ${grouped[gu].map((r) => `
                    <div class="report-card" style="background:#fffbe6; border-radius:16px; box-shadow:0 2px 12px rgba(0,0,0,0.08); border:2px solid ${style.color}; padding:18px 16px; min-width:220px; max-width:260px; font-size:1em; position:relative; display:flex; flex-direction:column; gap:8px;">
                      <div style="display:flex; align-items:center; gap:8px;">
                        <img src="dream_family_02.png" alt="ê¿ˆëŒì´ ê°€ì¡±" style="height:28px; vertical-align:middle;">
                        <span style="font-weight:600; color:${style.color};">${r.reportType}</span>
                      </div>
                      <div style="color:#222; font-size:1.08em; margin-bottom:4px;">${r.content}</div>
                      ${r.imageData ? `<img src="${r.imageData}" alt="ì²¨ë¶€ì‚¬ì§„" style="max-width:100%; max-height:80px; border-radius:8px; margin-bottom:4px;">` : ''}
                      <div style="color:#888; font-size:0.98em;">${r.created_at ? new Date(r.created_at).toLocaleString('ko-KR') : ''}</div>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>`;
          });
          container.innerHTML = html;
        } catch (e) {
          container.innerHTML = `<div style='color:red; text-align:center; margin:48px 0;'>ì œë³´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
        }
      }
      document.addEventListener('DOMContentLoaded', renderCommunityCards);
      </script>
    </div>
    
  </div>
</body>
</html>